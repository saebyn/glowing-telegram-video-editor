import{j as d}from"./jsx-runtime-D_zvdyIk.js";import{r as h}from"./index-BCtMShv3.js";import{u as N,T as S,c as K,g as X}from"./TimeDotMarker-LlRL-T5m.js";import{t as k}from"./TimelineLegend-51XuBE88.js";import{f as W}from"./duration-B3hTHHeC.js";function _({startMilliseconds:n,endMilliseconds:o,text:r,className:f,onClick:l}){const[s,m]=h.useState(!1),{timeToRelative:v}=N(),i=o&&v(o)-v(n),a=i!==void 0?`max(${i*100}%, 0.125rem)`:"0.125rem",g=c=>{if(l&&c.shiftKey){m(!0);return}m(!1)},M=c=>{l&&c.shiftKey&&m(!0)},T=c=>{m(!1)},y=()=>{s&&l&&l()};return d.jsx("div",{title:r,onClick:y,onMouseEnter:g,onMouseLeave:g,onMouseMove:g,tabIndex:-1,onKeyDown:M,onKeyUp:T,className:`absolute top-1/2 size-1 -translate-y-1/2 ${f} ${s?"cursor-pointer":""}`,style:{left:`${v(n)*100}%`,width:a}})}try{_.displayName="TimeSegmentMarker",_.__docgenInfo={description:"",displayName:"TimeSegmentMarker",props:{startMilliseconds:{defaultValue:null,description:"",name:"startMilliseconds",required:!0,type:{name:"number"}},endMilliseconds:{defaultValue:null,description:"",name:"endMilliseconds",required:!0,type:{name:"number | undefined"}},className:{defaultValue:null,description:"",name:"className",required:!0,type:{name:"string"}},text:{defaultValue:null,description:"",name:"text",required:!0,type:{name:"string"}},onClick:{defaultValue:null,description:"",name:"onClick",required:!1,type:{name:"(() => void)"}}}}}catch{}function E({content:{startMilliseconds:n,endMilliseconds:o,type:r,text:f},onClick:l}){if(r==="chat")return d.jsx(S,{timestampMilliseconds:n,className:`z-40 ${k[r]}`});let s="";return r==="silence"?s="z-0 h-16 ":r==="highlight"?s="z-10 h-12 ":r==="attention"?s="z-20 h-10 ":r==="error"&&(s="z-30 h-8 "),s+=k[r],d.jsx(_,{onClick:l,startMilliseconds:n,endMilliseconds:o,className:s,text:f})}try{E.displayName="TimelineElement",E.__docgenInfo={description:"",displayName:"TimelineElement",props:{content:{defaultValue:null,description:"",name:"content",required:!0,type:{name:"TimelineItem<TimelineElementType>"}},onClick:{defaultValue:null,description:"",name:"onClick",required:!0,type:{name:"() => void"}}}}}catch{}function L({content:{chat_history:n,silences:o,highlights:r,attentions:f,transcription_errors:l},playheadTime:s,onSeekToTime:m,onItemSelect:v}){const i=h.useRef(null),a=N(),[g,M]=h.useState(null),[T,y]=h.useState(null);function c(){return g===null?!1:new Date().getTime()-g>250}h.useEffect(()=>(document.addEventListener("mouseup",b),document.addEventListener("mousemove",I),()=>{document.removeEventListener("mouseup",b),document.removeEventListener("mousemove",I)})),h.useEffect(()=>{if(!i.current)return;const e=i.current,t=u=>{u.preventDefault();const p=u.deltaY,C=(u.pageX-e.offsetLeft)/e.clientWidth;p>0?a.zoomOut(C):a.zoomIn(C)};return e.addEventListener("wheel",t,{passive:!1}),()=>{e.removeEventListener("wheel",t)}},[a]);const V=K([...o.map((e,t)=>({type:"silence",startMilliseconds:e.timestamp,endMilliseconds:e.timestamp_end&&e.timestamp_end,text:e.description||"",originIndex:t})),...r.map((e,t)=>({type:"highlight",startMilliseconds:e.timestamp,endMilliseconds:e.timestamp_end&&e.timestamp_end,text:e.description||"",originIndex:t})),...f.map((e,t)=>({type:"attention",startMilliseconds:e.timestamp,endMilliseconds:e.timestamp_end&&e.timestamp_end,text:e.description||"",originIndex:t})),...l.map((e,t)=>({type:"error",startMilliseconds:e.timestamp,endMilliseconds:e.timestamp_end&&e.timestamp_end,text:e.description||"",originIndex:t})),...n.map((e,t)=>({type:"chat",startMilliseconds:e.timestamp,text:e.username,originIndex:t}))]),w=a.getVisibleElements(V),D=()=>{M(new Date().getTime())},b=e=>{e.preventDefault(),M(null)},I=e=>{if(!i.current)return;const t=i.current;if(c()){y(null);const{movementX:u}=e,p=u/t.clientWidth,x=Math.round(-p*a.getLength());a.pan(x)}},q=e=>{if(!i.current)return;const t=i.current;if(!c()){const p=(e.pageX-t.offsetLeft)/t.clientWidth;y(p)}},j=()=>{y(null)},z=e=>{if(!i.current||c()||e.shiftKey)return;const t=i.current.clientWidth,p=(e.pageX-i.current.offsetLeft)/t,x=Math.round(a.relativeToTime(p));m&&m(x)};return d.jsxs("div",{className:"relative h-16 cursor-crosshair select-none overflow-hidden rounded-sm bg-gray-200 dark:bg-gray-600",ref:i,onMouseDown:D,onMouseLeave:j,onMouseMove:q,onClick:z,children:[d.jsx($,{hoverLocation:T,lens:a}),w.map(e=>d.jsx(E,{content:e,onClick:()=>{if(v){let t;switch(e.type){case"silence":t=o;break;case"highlight":t=r;break;case"attention":t=f;break;case"error":t=l;break;case"chat":t=n;break;default:throw new Error("Invalid type")}v(t[e.originIndex])}}},X(e))),d.jsx(_,{onClick:()=>{},startMilliseconds:s,endMilliseconds:void 0,text:"",className:`z-50 h-16 ${k.cursor}`})]})}function $({hoverLocation:n,lens:o}){return n===null?null:d.jsx("div",{className:`p-8 absolute top-0 z-50
        `,style:{left:`${n*100}%`},children:W(o.relativeToTime(n))})}try{L.displayName="Timeline",L.__docgenInfo={description:"",displayName:"Timeline",props:{content:{defaultValue:null,description:"",name:"content",required:!0,type:{name:"VideoMetadata"}},playheadTime:{defaultValue:null,description:"",name:"playheadTime",required:!0,type:{name:"number"}},onSeekToTime:{defaultValue:null,description:"",name:"onSeekToTime",required:!1,type:{name:"((time: number) => void)"}},onItemSelect:{defaultValue:null,description:"",name:"onItemSelect",required:!1,type:{name:"((item: Section) => void)"}}}}}catch{}export{L as T};
