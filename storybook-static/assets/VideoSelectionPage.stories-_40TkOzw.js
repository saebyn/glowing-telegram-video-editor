import{a as H}from"./index-B-lxVbXh.js";import{j as e}from"./jsx-runtime-D_zvdyIk.js";import{B as g}from"./Button-Bzr3v68e.js";import{H as _}from"./Heading-Dis_vig6.js";import{C as z}from"./ClipSelectionDialog-BqZ2LQ6l.js";import{r as u}from"./index-BCtMShv3.js";import{T as b}from"./TimeLink-F3qPxSm4.js";import{T as K}from"./TimelineLegend-51XuBE88.js";import{u as O,a as B}from"./TimeDotMarker-LlRL-T5m.js";import{V as G}from"./VideoPlayer-B58sX8vF.js";import{a as M,T as R}from"./Tab-Am_1O7TH.js";import{A as L}from"./AnimatedHamburgerIconButton-B6rBOU-g.js";import{H as j}from"./HeadingLink-DgeBOh39.js";import{S as Z}from"./Search-D8QBzCW9.js";import{T as U}from"./Timeline-23JOFXqj.js";import"./v4-CtRu48qb.js";import"./IconButton-DZr07qzo.js";import"./duration-B3hTHHeC.js";import"./VideoPlayerProgressBar-D8_9c6qX.js";function v(t,n,a,l){const s=W(t,a);return u.useEffect(()=>{var r;if(!l)return;const i=(r=n.current)==null?void 0:r.querySelector(`[data-index="${s}"]`);i&&i.scrollIntoView({behavior:"smooth",block:"center"})},[n,s,l]),s}function W(t,n){let a=null,l=Number.POSITIVE_INFINITY;for(let s=0;s<n.length;s++){const i=n[s],r=Math.abs(i.timestamp-t);if(r<l)a=s,l=r;else if(r>l)break}return a}try{v.displayName="useScrollToNearestElementToTime",v.__docgenInfo={description:`A hook that finds the nearest element to the given time in the log
and scrolls the element into view.`,displayName:"useScrollToNearestElementToTime",props:{}}}catch{}function V({log:t,onChange:n,onAdd:a,onRemove:l,playheadTime:s,onSeekToTime:i,contentField:r,followPlayback:d=!0}){const m=u.createRef(),c=v(s,m,t,d);return e.jsx("div",{className:"mt-4",ref:m,children:e.jsx("ul",{children:t.map((p,y)=>e.jsxs("li",{className:`mb-2 ${y===c?"bg-gray-200 dark:bg-gray-700":""} group relative flex items-start`,"data-index":y,children:[e.jsx(b,{milliseconds:p.timestamp,onClick:i})," ",e.jsx("textarea",{className:"inline  w-full border-none bg-transparent pl-2 focus:border-transparent focus:outline-hidden focus:ring-0",value:String(p[r]),onChange:o=>{n({...p,[r]:o.target.value})}}),e.jsxs("div",{className:"absolute  bottom-0 right-1/2 hidden group-hover:block",children:[e.jsx("button",{type:"button",className:" m-2 text-lg text-red-600 hover:text-red-800",onClick:()=>{l(p)},children:"ðŸ—‘"}),e.jsx("button",{type:"button",className:"m-2 text-lg text-green-600 hover:text-green-800",onClick:()=>{const o={...p,timestamp:p.timestamp+1e3};a(o),i(o.timestamp)},children:"âž•"})]})]},`entry-${p.timestamp}`))})})}try{V.displayName="EditableTimestampedEventLog",V.__docgenInfo={description:"",displayName:"EditableTimestampedEventLog",props:{log:{defaultValue:null,description:"",name:"log",required:!0,type:{name:"T[]"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(updatedEvent: T) => void"}},onAdd:{defaultValue:null,description:"",name:"onAdd",required:!0,type:{name:"(newEvent: T) => void"}},onRemove:{defaultValue:null,description:"",name:"onRemove",required:!0,type:{name:"(event: T) => void"}},playheadTime:{defaultValue:null,description:"",name:"playheadTime",required:!0,type:{name:"number"}},onSeekToTime:{defaultValue:null,description:"",name:"onSeekToTime",required:!0,type:{name:"(milliseconds: number) => void"}},contentField:{defaultValue:null,description:"",name:"contentField",required:!0,type:{name:"string | number | symbol"}},followPlayback:{defaultValue:{value:"true"},description:"",name:"followPlayback",required:!1,type:{name:"boolean"}}}}}catch{}function f({rows:t,includeEnd:n=!1,includeReasoning:a=!1,includeCategory:l=!1,canEdit:s=!1,canClip:i=!1,playheadTime:r,onSeekToTime:d,onClip:m}){return e.jsx("section",{className:"mb-6 text-gray-700 dark:text-gray-200",children:e.jsxs("table",{className:"min-w-full rounded-sm bg-white shadow-md dark:bg-gray-600",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"border-b px-4 py-2 text-start",children:n?"Start Time":"Time"}),n&&e.jsx("th",{className:"border-b px-4 py-2 text-start",children:"End Time"}),l&&e.jsx("th",{className:"border-b px-4 py-2 text-start",children:"Category"}),e.jsx("th",{className:"border-b px-4 py-2 text-start",children:"Description"}),a&&e.jsx("th",{className:"border-b px-4 py-2 text-start",children:"Reasoning"}),e.jsx("th",{className:"border-b px-4 py-2 text-start",children:"Actions"})]})}),e.jsx("tbody",{children:t.map(c=>e.jsxs("tr",{className:`${r&&c.timestamp<=r&&(c.timestamp_end||0)>=r?"bg-gray-200 dark:bg-gray-700":""}`,children:[e.jsx("td",{className:"border-b px-4 py-2",children:e.jsx(b,{milliseconds:c.timestamp,onClick:d})}),n&&e.jsx("td",{className:"border-b px-4 py-2",children:e.jsx(b,{milliseconds:c.timestamp_end,onClick:d})}),l&&e.jsx("td",{className:"border-b px-4 py-2",children:c==null?void 0:c.category}),e.jsx("td",{className:"border-b px-4 py-2",children:c.description}),a&&e.jsx("td",{className:"border-b px-4 py-2",children:c.reasoning}),e.jsxs("td",{className:"border-b px-4 py-2 text-right",children:[s&&e.jsx(g,{className:"mx-2 rounded-sm  text-white bg-green-500 dark:bg-green-600 dark:text-white",children:"Edit"}),i&&e.jsx(g,{className:"mx-2 rounded-sm bg-blue-500 text-white dark:!bg-blue-600 dark:text-white",onClick:()=>m==null?void 0:m(c),children:"Clip"}),e.jsx(g,{className:"rounded-sm bg-red-500 text-white dark:bg-red-600 dark:text-white",children:"Delete"})]})]},`row-${c.category}-${c.timestamp}`))})]})})}try{f.displayName="TimeTable",f.__docgenInfo={description:"",displayName:"TimeTable",props:{rows:{defaultValue:null,description:"",name:"rows",required:!0,type:{name:"Section[]"}},includeEnd:{defaultValue:{value:"false"},description:"",name:"includeEnd",required:!1,type:{name:"boolean"}},includeReasoning:{defaultValue:{value:"false"},description:"",name:"includeReasoning",required:!1,type:{name:"boolean"}},includeCategory:{defaultValue:{value:"false"},description:"",name:"includeCategory",required:!1,type:{name:"boolean"}},canEdit:{defaultValue:{value:"false"},description:"",name:"canEdit",required:!1,type:{name:"boolean"}},canClip:{defaultValue:{value:"false"},description:"",name:"canClip",required:!1,type:{name:"boolean"}},playheadTime:{defaultValue:null,description:"",name:"playheadTime",required:!1,type:{name:"number"}},onSeekToTime:{defaultValue:null,description:"",name:"onSeekToTime",required:!1,type:{name:"((milliseconds: number) => void)"}},onClip:{defaultValue:null,description:"",name:"onClip",required:!1,type:{name:"((section: Section) => void)"}}}}}catch{}function w({followPlayback:t,setFollowPlayback:n}){const a=O(),l=()=>{a.reset()},s=()=>{a.zoomIn(.5)},i=()=>{a.zoomOut(.5)};return e.jsxs("div",{className:`mt-4 rounded-sm bg-gray-200
              p-4 text-gray-800 dark:bg-gray-700 dark:text-gray-200
              `,children:[e.jsx(K,{}),e.jsx(g,{onClick:s,children:"Zoom In"}),e.jsx(g,{className:"mx-2 rounded-sm bg-gray-300 px-4 py-2 dark:bg-gray-400",onClick:i,children:"Zoom Out"}),e.jsx(g,{className:"mx-2 rounded-sm bg-gray-300 px-4 py-2 dark:bg-gray-400",onClick:l,children:"Reset"}),e.jsxs("label",{className:"flex items-center space-x-2 p-4",children:[e.jsx("input",{type:"checkbox",checked:t,onChange:r=>n(r.target.checked)}),e.jsx("span",{children:"Follow playback"})]})]})}try{w.displayName="TimelineControls",w.__docgenInfo={description:"",displayName:"TimelineControls",props:{followPlayback:{defaultValue:null,description:"",name:"followPlayback",required:!0,type:{name:"boolean"}},setFollowPlayback:{defaultValue:null,description:"",name:"setFollowPlayback",required:!0,type:{name:"(followPlayback: boolean) => void"}}}}}catch{}function C({log:t,playheadTime:n,onSeekToTime:a,renderEvent:l,followPlayback:s=!0}){const i=u.createRef(),r=v(n,i,t,s);return e.jsx("div",{className:"mt-4",ref:i,children:e.jsx("ul",{children:t.map((d,m)=>e.jsxs("li",{className:`mb-2 ${m===r?"bg-gray-200 dark:bg-gray-700":""}`,"data-index":m,children:[e.jsx(b,{milliseconds:d.timestamp,onClick:a})," ",l(d)]},`entry-${d.timestamp}`))})})}try{C.displayName="TimestampedEventLog",C.__docgenInfo={description:"",displayName:"TimestampedEventLog",props:{log:{defaultValue:null,description:"",name:"log",required:!0,type:{name:"T[]"}},playheadTime:{defaultValue:null,description:"",name:"playheadTime",required:!0,type:{name:"number"}},onSeekToTime:{defaultValue:null,description:"",name:"onSeekToTime",required:!0,type:{name:"(milliseconds: number) => void"}},renderEvent:{defaultValue:null,description:"",name:"renderEvent",required:!0,type:{name:"(event: T) => ReactNode"}},followPlayback:{defaultValue:{value:"true"},description:"",name:"followPlayback",required:!1,type:{name:"boolean"}}}}}catch{}function E({chatHistory:t,timeline:n,transcript:a,videoPlayer:l,settings:s}){const[i,r]=u.useState("chat");return e.jsx("section",{className:"mb-6",children:e.jsxs("div",{className:"rounded-sm p-4 shadow-md",children:[e.jsxs("div",{className:" mb-4 grid w-full grid-cols-3",children:[e.jsx("div",{className:"col-span-2",children:l}),e.jsx("div",{className:`col-span-1 h-0 min-h-full overflow-y-scroll bg-gray-200
                  text-gray-800 shadow-md dark:bg-gray-600 dark:text-gray-200
                `,children:e.jsxs(M,{tabs:e.jsxs(e.Fragment,{children:[e.jsx(R,{title:"Chat",active:i==="chat",onClick:()=>r("chat")}),e.jsx(R,{title:"Transcript",active:i==="transcript",onClick:()=>r("transcript")})]}),children:[i==="transcript"&&a,i==="chat"&&t]})})]}),n,s]})})}try{E.displayName="Viewport",E.__docgenInfo={description:"A layout for the viewport, which contains the `VideoPlayer`,\n`VideoCaption`, transcript/chat sidebar, and `Timeline`.\n\nThe layout is divided into two sections: the video player and the\ntranscript/chat sidebar. The video player takes up 2/3 of the width\nand the sidebar takes up 1/3 of the width. Then, the `Timeline` is\ndisplayed below the video player and sidebar.",displayName:"Viewport",props:{videoPlayer:{defaultValue:null,description:"",name:"videoPlayer",required:!1,type:{name:"ReactNode"}},transcript:{defaultValue:null,description:"",name:"transcript",required:!1,type:{name:"ReactNode"}},chatHistory:{defaultValue:null,description:"",name:"chatHistory",required:!1,type:{name:"ReactNode"}},timeline:{defaultValue:null,description:"",name:"timeline",required:!1,type:{name:"ReactNode"}},settings:{defaultValue:null,description:"",name:"settings",required:!1,type:{name:"ReactNode"}}}}}catch{}const Y=5e3;function x({timestamp:t,description:n,onSeekToTime:a,playheadTime:l}){const s=l&&Math.abs(l-t)<Y;return e.jsx("li",{className:`ml-4 ${s?"bg-gray-300 dark:bg-gray-600":""}`,children:e.jsxs(b,{className:"p-4 text-gray-700 dark:text-gray-200",href:`#${t}`,milliseconds:t,onClick:a,children:[" ","- ",n==null?void 0:n.substring(0,30),"..."]})},`error-${t}`)}try{x.displayName="NavEntry",x.__docgenInfo={description:"",displayName:"NavEntry",props:{timestamp:{defaultValue:null,description:"",name:"timestamp",required:!0,type:{name:"number"}},description:{defaultValue:null,description:"",name:"description",required:!1,type:{name:"string"}},onSeekToTime:{defaultValue:null,description:"",name:"onSeekToTime",required:!0,type:{name:"(milliseconds: number) => void"}},playheadTime:{defaultValue:null,description:"",name:"playheadTime",required:!1,type:{name:"number"}}}}}catch{}function q({content:t,onSeekToTime:n,playheadTime:a}){const[l,s]=u.useState(""),[i,r]=u.useState(!1);return i?e.jsxs("aside",{className:`w-96 overflow-y-scroll bg-white shadow-md dark:bg-gray-900 dark:text-gray-200
    `,children:[e.jsx(L,{isExpanded:i,onClick:()=>r(!i)}),e.jsx("div",{className:"relative p-4",children:e.jsx(Z,{text:l,setText:s,label:"Filter..."})}),e.jsx("nav",{className:"mt-4",children:e.jsxs("ul",{children:[e.jsx("li",{children:e.jsx(j,{href:"#highlights",children:"Highlights"})}),t.highlights.filter(S(l)).map(d=>e.jsx(x,{...d,playheadTime:a,onSeekToTime:n},`highlight-${d.timestamp}`)),e.jsx("li",{children:e.jsx("button",{type:"button",className:"block w-full p-4 text-gray-700 hover:bg-gray-200 dark:text-gray-200 dark:hover:bg-gray-700",children:"Add New"})}),e.jsx("li",{children:e.jsx(j,{href:"#attentions",children:"Attentions"})}),t.attentions.filter(S(l)).map(d=>e.jsx(x,{...d,playheadTime:a,onSeekToTime:n},`attention-${d.timestamp}`)),e.jsx("li",{children:e.jsx(j,{href:"#transcription-errors",children:"Transcription Errors"})}),t.transcription_errors.filter(S(l)).map(d=>e.jsx(x,{...d,playheadTime:a,onSeekToTime:n},`error-${d.timestamp}`)),e.jsx("li",{children:e.jsx(j,{href:"#top",children:"Back to Top"})})]})})]}):e.jsx("aside",{className:"h-full w-20 bg-white shadow-md dark:bg-gray-900 dark:text-gray-200",children:e.jsx(L,{isExpanded:i,onClick:()=>r(!i)})})}function S(t){return n=>[n.category,n.description,n.reasoning].some(a=>a==null?void 0:a.toLowerCase().includes(t.toLowerCase()))}try{q.displayName="Sidebar",q.__docgenInfo={description:"",displayName:"Sidebar",props:{content:{defaultValue:null,description:"",name:"content",required:!0,type:{name:"VideoMetadata"}},onSeekToTime:{defaultValue:null,description:"",name:"onSeekToTime",required:!0,type:{name:"(milliseconds: number) => void"}},playheadTime:{defaultValue:null,description:"",name:"playheadTime",required:!1,type:{name:"number"}}}}}catch{}const I=t=>{u.useEffect(()=>{const n=a=>{const s=`${[a.ctrlKey?"Ctrl":"",a.shiftKey?"Shift":"",a.altKey?"Alt":"",a.metaKey?"Meta":"",a.key].filter(i=>i!=="").join("+")}`;t[s]&&(a.preventDefault(),t[s](a))};return document.addEventListener("keydown",n),()=>{document.removeEventListener("keydown",n)}},[t])};try{I.displayName="useKeyboardShortcuts",I.__docgenInfo={description:"",displayName:"useKeyboardShortcuts",props:{}}}catch{}async function J(t,n){const a=[],l=n.filter(i=>i.timestamp_end!==void 0).filter(i=>i.timestamp_end-i.timestamp>=t.minSectionDuration),s=[{timestamp:0,timestamp_end:0},...l,{timestamp:t.length,timestamp_end:t.length}];for(let i=0;i<s.length-1;i++){const r=s[i],d=s[i+1];d.timestamp-r.timestamp_end>=t.minGapDuration&&a.push({id:`${r.timestamp_end}-${d.timestamp}`,start:r.timestamp_end,end:d.timestamp})}return a}const Q={minGapDuration:3e4,minSectionDuration:6e4};function P({content:t,onExport:n}){const[a,l]=u.useState(0),[s,i]=u.useState(!0),r=u.useRef(null),[d,m]=u.useState([]);function c(o){var h;(h=r.current)==null||h.seekTo(o)}function p(o){const h={id:o.timestamp.toString(),start:o.timestamp,end:o.timestamp_end||o.timestamp+1e4};m(N=>[...N.filter(F=>F.id!==h.id),h])}function y(o){return h=>{m(N=>N.map(T=>T.id===h?{...T,[o]:a}:T))}}return I({1:()=>{r.current&&r.current.seekTo(0)}," ":()=>{r.current&&r.current.togglePlay()},ArrowLeft:()=>{r.current&&r.current.seekTo(a-250)},ArrowRight:()=>{r.current&&r.current.seekTo(a+250)},"Shift+ArrowLeft":()=>{r.current&&r.current.seekTo(a-1e3)},"Shift+ArrowRight":()=>{r.current&&r.current.seekTo(a+1e3)}}),e.jsx(B,{contentLength:t.length,children:e.jsxs("div",{className:"flex h-screen bg-gray-100 dark:bg-gray-800",children:[e.jsx(z,{show:d.length>0,clips:d,onExport:()=>{n==null||n(d)},onClear:()=>m([]),onReorder:o=>m(o),onRemove:o=>m(d.filter(h=>h.id!==o)),onCopyStartTime:y("start"),onCopyEndTime:y("end"),onSeekToTime:c}),e.jsx(q,{content:t,onSeekToTime:c,playheadTime:a}),e.jsx("div",{className:"flex flex-1 flex-col",children:e.jsxs("main",{className:"flex-1 overflow-auto p-4",children:[e.jsx(_,{level:1,id:"top",children:t.title}),e.jsx(E,{videoPlayer:e.jsx(G,{ref:r,videoUrl:t.video_url,onTimeUpdate:o=>l(o)}),chatHistory:e.jsx(C,{log:t.chat_history,playheadTime:a,onSeekToTime:c,renderEvent:o=>e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"font-bold",children:o.username}),":"," ",o.message]}),followPlayback:s}),timeline:e.jsx(U,{content:t,playheadTime:a,onSeekToTime:c,onItemSelect:p}),transcript:e.jsx(V,{log:t.transcript,onChange:o=>{console.log(o)},onAdd:o=>{console.log(o)},onRemove:o=>{console.log(o)},playheadTime:a,onSeekToTime:c,contentField:"text",followPlayback:s}),settings:e.jsx(w,{followPlayback:s,setFollowPlayback:i})}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(g,{onClick:()=>{n==null||n(d)},variant:"primary",children:"Export"}),e.jsx(g,{onClick:async()=>{m(await J({...Q,length:t.length},t.silences))},children:"Clip Silences"})]}),e.jsx(_,{level:2,id:"highlights",children:"Highlights"}),e.jsx(f,{rows:t.highlights,onSeekToTime:c,playheadTime:a,includeEnd:!0,includeReasoning:!0,canEdit:!0,canClip:!0,onClip:p}),e.jsx(_,{level:2,id:"attentions",children:"Attentions"}),e.jsx(f,{rows:t.attentions,onSeekToTime:c,playheadTime:a,includeEnd:!0,includeReasoning:!0}),e.jsx(_,{level:2,id:"transcription-errors",children:"Transcription Errors"}),e.jsx(f,{rows:t.transcription_errors,playheadTime:a,onSeekToTime:c,includeCategory:!0})]})})]})})}try{P.displayName="VideoSelectionPage",P.__docgenInfo={description:"",displayName:"VideoSelectionPage",props:{content:{defaultValue:null,description:"",name:"content",required:!0,type:{name:"VideoMetadata"}},onExport:{defaultValue:null,description:"",name:"onExport",required:!1,type:{name:"((clips: VideoClip[]) => void)"}}}}}catch{}const xe={title:"Pages/VideoSelectionPage",component:P,tags:["pages"]},k={args:{content:{title:"Test Video",video_url:"https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8",length:634e3,highlights:[{timestamp:0,timestamp_end:1e4,description:"This is a test highlight",reasoning:"This is the reasoning for the highlight"},{timestamp:2e4,timestamp_end:3e4,description:"This is another test highlight",reasoning:"This is the reasoning for the highlight"}],attentions:[],transcription_errors:[],silences:[],chat_history:[],transcript:[]},onExport:H("Export")}};var $,A,D;k.parameters={...k.parameters,docs:{...($=k.parameters)==null?void 0:$.docs,source:{originalSource:`{
  args: {
    content: {
      title: "Test Video",
      video_url: "https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8",
      // 10 minutes, 34 seconds, in milliseconds
      length: 634000,
      highlights: [{
        timestamp: 0,
        timestamp_end: 10000,
        description: "This is a test highlight",
        reasoning: "This is the reasoning for the highlight"
      }, {
        timestamp: 20000,
        timestamp_end: 30000,
        description: "This is another test highlight",
        reasoning: "This is the reasoning for the highlight"
      }],
      attentions: [],
      transcription_errors: [],
      silences: [],
      chat_history: [],
      transcript: []
    },
    onExport: action("Export")
  }
}`,...(D=(A=k.parameters)==null?void 0:A.docs)==null?void 0:D.source}}};const be=["Default"];export{k as Default,be as __namedExportsOrder,xe as default};
